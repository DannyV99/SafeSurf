<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Interactive Terminal Room</title>
  <style>
    body { font-family: monospace; background: #111; color: #eee; display: flex; justify-content: center; align-items: center; height: 100vh; margin:0; }
    .card { width: 90%; max-width: 600px; background: #222; padding: 20px; border-radius: 12px; }
    .terminal { background: #000; padding: 10px; height: 200px; overflow-y: auto; border-radius: 8px; margin-bottom: 12px; }
    input, textarea, button { font: inherit; margin-top: 6px; }
    input { width: 100%; padding: 6px; border-radius: 4px; border: none; background: #333; color: #eee; }
    textarea { width: 100%; height: 80px; padding: 6px; background: #111; color: #0f0; border-radius: 4px; }
    button { padding: 8px 12px; border: none; background: #0f62fe; color: #fff; border-radius: 4px; cursor: pointer; }
    button:disabled { opacity:.5; }
    .results { background:#013220; padding:10px; border-radius:6px; margin-top:10px; }
  </style>
</head>
<body>
<div class="card">
  <div id="joinView">
    <p>Enter Room Code:</p>
    <input id="room" placeholder="ABCD"/>
    <button id="joinBtn">Join</button>
    <div id="err" style="color:red"></div>
  </div>

  <div id="gameView" style="display:none">
    <p>People in room: <span id="count">1</span>/2</p>
    <div class="terminal" id="terminal"></div>
    <input id="cmd" placeholder="Type a command (ls, cd, cat)" disabled />
    <div id="answerBox" style="display:none">
      <p>Paste file contents here:</p>
      <textarea id="answer"></textarea>
      <button id="sendBtn">Submit Answer</button>
    </div>
    <div id="results" class="results" style="display:none"></div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// Fake file system
const fs = {
  "/": ["home", "etc", "secret.txt"],
  "/home": ["notes.md", "tasks.txt"],
  "/etc": ["config.ini"],
};
const fileContents = {
  "secret.txt": "FLAG{winner_found}",
  "notes.md": "Groceries list...",
  "tasks.txt": "Do laundry",
  "config.ini": "setting=value"
};
let cwd = "/";

// helpers
function log(msg){ terminal.innerHTML += msg + "<br>"; terminal.scrollTop = terminal.scrollHeight; }
function runCommand(cmd){
  const parts = cmd.trim().split(" ");
  if(parts[0]==="ls"){
    log(fs[cwd].join(" "));
  } else if(parts[0]==="cd"){
    const dir = parts[1];
    const newPath = dir===".." ? "/" : (cwd==="/" ? "/"+dir : cwd+"/"+dir);
    if(fs[newPath]) { cwd=newPath; log("moved to "+cwd); }
    else log("no such directory");
  } else if(parts[0]==="cat"){
    const f = parts[1];
    if(fs[cwd].includes(f)) log(fileContents[f]||"(empty)");
    else log("no such file");
  } else log("command not found");
}

const joinView=document.getElementById("joinView");
const gameView=document.getElementById("gameView");
const joinBtn=document.getElementById("joinBtn");
const roomInput=document.getElementById("room");
const err=document.getElementById("err");
const countEl=document.getElementById("count");
const terminal=document.getElementById("terminal");
const cmdInput=document.getElementById("cmd");
const answerBox=document.getElementById("answerBox");
const answerEl=document.getElementById("answer");
const sendBtn=document.getElementById("sendBtn");
const resultsEl=document.getElementById("results");

joinBtn.onclick=()=>{
  socket.emit("join",{room:roomInput.value.trim()});
};
socket.on("errorMsg",(m)=>{err.textContent=m;});
socket.on("joined",()=>{joinView.style.display="none";gameView.style.display="block"; log("Connected. Waiting for partner...");});
socket.on("roomUpdate",({count})=>{countEl.textContent=count;});
socket.on("ready",()=>{ log("Both connected. Start typing commands!"); cmdInput.disabled=false; answerBox.style.display="block";});

cmdInput.addEventListener("keydown",e=>{
  if(e.key==="Enter"){ log("$ "+cmdInput.value); runCommand(cmdInput.value); cmdInput.value=""; }
});

sendBtn.onclick=()=>{socket.emit("answer",answerEl.value.trim()); sendBtn.disabled=true; answerEl.disabled=true;};
socket.on("results",(pairs)=>{
  resultsEl.innerHTML=pairs.map(p=>`<div><b>${p.who}</b>: ${p.answer}</div>`).join("");
  resultsEl.style.display="block";
});
</script>
</body>
</html>

