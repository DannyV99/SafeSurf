<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mailbox Room</title>
  <style>
    body { font-family: monospace; background:#111; color:#eee; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
    .card { width:90%; max-width:600px; background:#222; padding:20px; border-radius:12px; }
    .mailbox { display:flex; gap:10px; margin-top:10px; }
    .list { flex:1; background:#000; padding:10px; border-radius:8px; height:200px; overflow-y:auto; }
    .list div { padding:6px; border-bottom:1px solid #333; cursor:pointer; }
    .list div:hover { background:#333; }
    .content { flex:2; background:#000; padding:10px; border-radius:8px; height:200px; overflow-y:auto; }
    input, textarea, button { font:inherit; margin-top:6px; }
    textarea { width:100%; height:80px; padding:6px; border-radius:4px; background:#111; color:#0f0; border:none; }
    button { padding:8px 12px; border:none; background:#0f62fe; color:#fff; border-radius:4px; cursor:pointer; }
    button:disabled { opacity:.5; }
    .results { background:#013220; padding:10px; border-radius:6px; margin-top:10px; }
    #joinView input { width:100%; padding:6px; border-radius:4px; border:none; background:#333; color:#eee; }
  </style>
</head>
<body>
<div class="card">
  <div id="joinView">
    <p>Enter Room Code:</p>
    <input id="room" placeholder="MAIL01"/>
    <button id="joinBtn">Join</button>
    <div id="err" style="color:red"></div>
  </div>

  <div id="gameView" style="display:none">
    <p>People in room: <span id="count">1</span>/2</p>
    <div class="mailbox">
      <div class="list" id="mailList"></div>
      <div class="content" id="mailContent">Select an email to read...</div>
    </div>
    <div id="answerBox" style="display:none">
      <p>Enter the subject of the phishing email you found:</p>
      <textarea id="answer"></textarea>
      <button id="sendBtn">Submit Answer</button>
    </div>
    <div id="results" class="results" style="display:none"></div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

// Fake mailbox
const emails = [
  {subject:"Team Lunch Tomorrow", body:"Hey team, don't forget lunch at noon."},
  {subject:"Update Your Password", body:"Your account has been compromised. Click here to reset: http://fake-link.com"},
  {subject:"Project Status", body:"Reminder to update your project tracker."}
];
const phishingSubject = "Update Your Password";

// render mailbox
const mailList = document.getElementById("mailList");
const mailContent = document.getElementById("mailContent");
emails.forEach((m) => {
  const div = document.createElement("div");
  div.textContent = m.subject;
  div.onclick = () => { mailContent.innerHTML = `<h4>${m.subject}</h4><p>${m.body}</p>`; };
  mailList.appendChild(div);
});

// UI elements
const joinView=document.getElementById("joinView");
const gameView=document.getElementById("gameView");
const joinBtn=document.getElementById("joinBtn");
const roomInput=document.getElementById("room");
const err=document.getElementById("err");
const countEl=document.getElementById("count");
const answerBox=document.getElementById("answerBox");
const answerEl=document.getElementById("answer");
const sendBtn=document.getElementById("sendBtn");
const resultsEl=document.getElementById("results");

// join logic
joinBtn.onclick = () => { socket.emit("join",{room:roomInput.value.trim()}); };
socket.on("errorMsg", (m) => { err.textContent=m; });
socket.on("joined", () => { joinView.style.display="none"; gameView.style.display="block"; });
socket.on("roomUpdate", ({count}) => { countEl.textContent=count; });
socket.on("ready", () => { answerBox.style.display="block"; });

// send answer
sendBtn.onclick = () => {
  socket.emit("answer", answerEl.value.trim());
  sendBtn.disabled=true; answerEl.disabled=true;
};

// results
socket.on("results", (pairs) => {
  resultsEl.innerHTML = "<strong>Results:</strong><br>" + 
    pairs.map(p => `<div><b>${p.who}</b>: ${p.answer} ${p.answer===phishingSubject?"✅ Correct":"❌ Wrong"}</div>`).join("");
  resultsEl.style.display="block";
});
</script>
</body>
</html>

